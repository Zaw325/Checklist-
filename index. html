<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chemical Checklist (Pro Version 2.0)</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

<style>
    /* Import Google Font 'Inter' */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

    body {
        font-family: 'Inter', sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 20px;
        color: #333;
    }

    .container {
        max-width: 900px;
        margin: 20px auto;
        background: #ffffff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    h1 {
        text-align: center;
        color: #2a4d69;
        font-weight: 600;
        margin-bottom: 5px; /* Reduced margin */
    }

    /* NEW: Style for the date */
    #checklist-date {
        text-align: center;
        font-size: 16px;
        color: #6c757d;
        margin-top: 0;
        margin-bottom: 25px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
        border-radius: 8px;
        overflow: hidden;
    }

    th, td {
        padding: 14px;
        text-align: left;
        border-bottom: 1px solid #e9ecef;
    }

    th {
        background-color: #4b86b4;
        color: white;
        text-transform: uppercase;
        font-size: 13px;
        letter-spacing: 0.5px;
    }

    tr:last-child td {
        border-bottom: none;
    }
    
    tr:hover {
        background-color: #f1f7ff;
    }

    input, textarea {
        width: 100%;
        border: 1px solid transparent;
        background: transparent;
        font-size: 14px;
        font-family: 'Inter', sans-serif;
        padding: 8px;
        box-sizing: border-box;
        border-radius: 6px;
        transition: border-color 0.3s, background-color 0.3s;
    }

    input:focus, textarea:focus {
        outline: none;
        background-color: #eef6ff;
        border-color: #4b86b4;
    }

    textarea {
        resize: vertical;
        min-height: 40px;
    }

    .btn-area {
        text-align: center;
        margin-top: 25px;
    }

    button {
        background-color: #2a4d69;
        color: white;
        border: none;
        padding: 12px 20px;
        margin: 5px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background-color 0.3s, transform 0.2s;
    }

    button:hover {
        background-color: #1b3143;
        transform: translateY(-2px);
    }

    button.pdf-btn {
        background-color: #006400;
    }
    button.pdf-btn:hover {
        background-color: #004d00;
    }

    button.print-btn {
        background-color: #6c757d;
    }
    button.print-btn:hover {
        background-color: #5a6268;
    }

    /* NEW: Style for the delete button in the row */
    .delete-btn {
        background-color: #dc3545; /* Red */
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        transition: background-color 0.3s;
    }
    .delete-btn:hover {
        background-color: #c82333;
    }

    /* NEW: Hide elements from Print & PDF */
    .no-print {
        display: table-cell; /* Show normally */
    }

    @media print {
        body {
            background-color: #fff;
            padding: 0;
            margin: 0;
        }
        .container {
            box-shadow: none;
            border: 1px solid #ccc;
            margin: 0;
            max-width: 100%;
        }
        .btn-area, .no-print {
            display: none !important; /* Hide buttons AND action column on print */
        }
    }
</style>
</head>
<body>

<div class="container">
    <h1>Chemical Checklist</h1>
    <p id="checklist-date"></p>

    <table id="checklistTable">
        <thead>
            <tr>
                <th>Items</th>
                <th>Current</th>
                <th>Needed</th>
                <th>Remark</th>
                <th class="no-print">Actions</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <div class="btn-area">
        <button onclick="addRow()">+ Add Row</button>
        <button onclick="exportPDF()" class="pdf-btn">üìÑ Export to PDF</button>
        <button onclick="window.print()" class="print-btn">üñ®Ô∏è Print</button>
    </div>
</div>

<script>
    // Initialize jsPDF library
    const { jsPDF } = window.jspdf;
    const STORAGE_KEY = 'chemicalChecklistData'; // Key for localStorage

    // Load data and set date when the page is first loaded
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        setDate();
    });

    // NEW: Function to set the current date
    function setDate() {
        const dateEl = document.getElementById('checklist-date');
        const today = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        dateEl.textContent = 'Date: ' + today.toLocaleDateString('en-US', options);
    }

    // Load data from localStorage
    function loadData() {
        const tableBody = document.getElementById("checklistTable").getElementsByTagName('tbody')[0];
        const dataString = localStorage.getItem(STORAGE_KEY);
        
        tableBody.innerHTML = ''; // Clear the table first

        if (dataString) {
            const data = JSON.parse(dataString);
            if (data.length > 0) {
                data.forEach(rowData => {
                    createRow(rowData);
                });
            } else {
                addRow(); 
            }
        } else {
            addRow(); 
        }
    }

    // Save data to localStorage (Auto-save)
    function saveData() {
        const tableBody = document.getElementById("checklistTable").getElementsByTagName('tbody')[0];
        const data = [];
        
        for (let row of tableBody.rows) {
            const rowData = {
                item: row.cells[0].querySelector('input').value,
                current: row.cells[1].querySelector('input').value,
                needed: row.cells[2].querySelector('input').value,
                remark: row.cells[3].querySelector('textarea').value
            };
            // Note: We don't save the 5th column (delete button)
            data.push(rowData);
        }
        
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // Create a new row and populate it with data
    function createRow(rowData) {
        const tableBody = document.getElementById("checklistTable").getElementsByTagName('tbody')[0];
        const newRow = tableBody.insertRow();
        
        const cellItem = newRow.insertCell(0);
        const cellCurrent = newRow.insertCell(1);
        const cellNeeded = newRow.insertCell(2);
        const cellRemark = newRow.insertCell(3);
        const cellAction = newRow.insertCell(4); // NEW: Action cell

        // Populate cells
        cellItem.innerHTML = `<input type="text" placeholder="e.g. Bleach" value="${rowData.item || ''}">`;
        cellCurrent.innerHTML = `<input type="text" placeholder="e.g. 2 bottles" value="${rowData.current || ''}">`;
        cellNeeded.innerHTML = `<input type="text" placeholder="e.g. 3 more" value="${rowData.needed || ''}">`;
        cellRemark.innerHTML = `<textarea placeholder="Note...">${rowData.remark || ''}</textarea>`;
        
        // NEW: Add delete button
        cellAction.classList.add('no-print'); // Add class to hide from print
        cellAction.innerHTML = `<button class="delete-btn" onclick="deleteRow(this)">Delete</button>`;

        // Attach the auto-save function to every input/textarea
        newRow.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', saveData);
        });
    }

    // Add a new row (when button is clicked)
    function addRow() {
        createRow({}); 
    }

    // NEW: Function to delete a row
    function deleteRow(button) {
        const row = button.parentElement.parentElement; // Get the <tr>
        // Add a confirmation pop-up
        if (confirm('Are you sure you want to delete this row?')) {
            row.parentElement.removeChild(row);
            saveData(); // Save the change
        }
    }

    // PDF Export Function
    function exportPDF() {
        if (typeof jsPDF === 'undefined' || typeof jsPDF.autoTable === 'undefined') {
            alert('Error: PDF libraries could not be loaded. Please check your internet connection and try again.');
            return;
        }

        const doc = new jsPDF();

        // Add Title and Date
        doc.text("Chemical Checklist", 14, 16);
        doc.setFontSize(12);
        doc.setTextColor(100); // Gray color
        doc.text(document.getElementById('checklist-date').textContent, 14, 22);

        doc.autoTable({
            html: '#checklistTable',
            startY: 28, // Start table after the date
            theme: 'grid',
            headStyles: {
                fillColor: [75, 134, 180]
            },
            // NEW: This function skips drawing the 5th column (index 4)
            willDrawCell: function (data) {
                if (data.column.index === 4) { // 4 is the 5th column (Actions)
                    return false; // Don't draw this cell
                }
            },
            // Correctly read values from input/textarea fields
            didParseCell: function (data) {
                if (data.cell.section === 'body' && data.column.index <= 3) {
                    const input = data.cell.raw.querySelector('input, textarea');
                    if (input) {
                        data.cell.text = input.value;
                    }
                }
            }
        });

        doc.save('Chemical_Checklist.pdf');
    }
</script>

</body>
</html>
