<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mrs. Sparkle - Inventory Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 'brand-blue': '#1e40af', 'brand-red': '#dc2626', 'brand-green': '#16a34a' }
                }
            }
        }
    </script>
    
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background-color: #f3f4f6; }
        .safe-area-pb { padding-bottom: env(safe-area-inset-bottom, 20px); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Dropdown reset */
        .unit-select {
            -webkit-appearance: none; appearance: none;
            background: transparent; border: none;
            text-align: center; font-weight: bold;
            font-size: 0.75rem; text-transform: uppercase;
            color: #6b7280; padding: 0 4px;
            cursor: pointer;
        }
        
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        @media print {
            @page { size: A4; margin: 1cm; }
            body { background: white; color: #1f2937; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            
            .no-print, .fab-btn, .stepper-btn, .icon-btn, #bottom-bar, .unit-select-arrow { display: none !important; }
            #app-container { padding: 0 !important; margin: 0 !important; max-width: 100% !important; }
            #header-section { border-bottom: 4px solid #1e40af !important; margin-bottom: 20px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-end; }
            
            /* Table Layout */
            .print-table-header, .item-card {
                display: grid !important;
                grid-template-columns: 40% 20% 20% 20%;
                gap: 0 !important;
            }
            .print-table-header { background-color: #1e40af !important; color: white !important; padding: 8px 10px; font-weight: bold; text-transform: uppercase; border-radius: 4px 4px 0 0; font-size: 10pt; }
            .item-card { border-bottom: 1px solid #e5e7eb; padding: 8px 10px !important; margin: 0 !important; border-radius: 0 !important; background: white !important; page-break-inside: avoid; }
            .item-card:nth-child(even) { background-color: #f9fafb !important; }

            .item-name-print { font-weight: bold; font-size: 11pt; }
            .qty-print { text-align: center; font-weight: 600; font-size: 11pt; }
            
            /* Center the Needed Column Content */
            .needed-print { text-align: center; font-weight: bold; font-size: 11pt; display: flex; justify-content: center; align-items: center; }
            
            .unit-display-print { display: inline !important; font-size: 0.8em; color: #666; margin-left: 2px; }
            .unit-select { display: none; } 

            input { border: none !important; background: transparent !important; width: 100%; padding: 0 !important; }
            .print-footer { display: flex !important; margin-top: 40px; justify-content: space-between; font-size: 10pt; border-top: 1px solid #ddd; padding-top: 10px; }
        }
    </style>
</head>
<body class="pb-32"> 

    <div id="app-container" class="max-w-3xl mx-auto p-4 md:p-8">
        <div id="header-section" class="bg-white rounded-2xl shadow-sm p-6 mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800 tracking-tight">Mrs. Sparkle</h1>
                <h2 class="text-xs md:text-sm text-brand-blue font-bold tracking-widest uppercase mt-1">Inventory Status</h2>
            </div>
            <div class="text-right">
                <p id="current-date" class="text-sm font-semibold text-gray-500"></p>
            </div>
        </div>
        
        <div class="print-table-header hidden no-print">
            <div>Item Name</div>
            <div class="text-center">Current</div>
            <div class="text-center">Needed</div>
            <div>Remark</div>
        </div>

        <div id="checklist-body" class="space-y-3"></div>

        <div class="print-footer hidden">
            <div>Generated by Mrs. Sparkle App</div>
            <div class="mt-8 pt-2 border-t border-gray-400 w-48 text-center">Checked By (Signature)</div>
        </div>
    </div>

    <button id="add-row-fab" class="fab-btn fixed bottom-24 right-5 bg-gray-900 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center active:scale-90 transition-transform z-40">
        <span class="material-icons-round text-3xl">add</span>
    </button>

    <div id="bottom-bar" class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-md border-t border-gray-200 shadow-lg z-50 safe-area-pb px-4 py-3">
        <div class="max-w-3xl mx-auto flex gap-3 justify-between items-center">
            <button id="clear-all-btn" class="text-red-500 font-medium text-sm px-3 py-2 rounded-lg hover:bg-red-50 transition">Clear All</button>
            <div class="flex gap-2">
                <button id="print-btn" class="flex items-center gap-2 bg-blue-50 text-brand-blue font-bold py-2.5 px-5 rounded-xl hover:bg-blue-100 transition shadow-sm border border-blue-100">
                    <span class="material-icons-round text-lg">print</span> Print
                </button>
                <button id="save-btn" class="flex items-center gap-2 bg-brand-blue text-white font-bold py-2.5 px-8 rounded-xl shadow-md hover:bg-blue-800 active:scale-95 transition">
                    <span class="material-icons-round text-lg">save</span> Save
                </button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed top-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl z-[70] hidden flex items-center gap-3 transition-all duration-300 opacity-0 translate-y-[-20px]">
        <span class="material-icons-round text-green-400">check_circle</span>
        <span class="font-medium">Saved Successfully</span>
    </div>

    <script>
        const CONFIG = { storageKey: 'sparkle_v3_units_print_fix' }; 
        const UNIT_OPTIONS = ['Btl', 'Box', 'Pcs', 'Pack', 'Can', 'Bag', 'Kg', 'L', 'Set'];

        const App = {
            data: [],
            init() {
                this.loadSystem();
                this.setupButtons();
            },
            loadSystem() {
                const dateStr = new Date().toLocaleDateString('en-SG', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' });
                document.getElementById('current-date').textContent = dateStr;
                const saved = localStorage.getItem(CONFIG.storageKey);
                this.data = saved ? JSON.parse(saved) : this.getDefaultTemplate();
                this.render();
            },
            getDefaultTemplate() {
                return [
                    { id: 1, item: 'Ma Ma Lemon', current: 1, unit: 'Btl', needed: 0, remark: '' },
                    { id: 2, item: 'Pine', current: 0, unit: 'Box', needed: 1, remark: '' },
                    { id: 3, item: 'Bleach', current: 2, unit: 'Can', needed: 0, remark: '' },
                    { id: 4, item: 'Sponge', current: 5, unit: 'Pcs', needed: 0, remark: '' },
                ];
            },
            setupButtons() {
                document.getElementById('add-row-fab').onclick = () => {
                    this.data.push({ id: Date.now(), item: '', current: 0, unit: 'Pcs', needed: 0, remark: '' });
                    this.render(); 
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                    this.save(false);
                };
                document.getElementById('save-btn').onclick = () => this.save(true);
                document.getElementById('print-btn').onclick = () => window.print();
                document.getElementById('clear-all-btn').onclick = () => {
                    if(confirm('Clear entire list?')) { this.data = []; this.render(); this.save(false); }
                };

                const listBody = document.getElementById('checklist-body');
                
                listBody.addEventListener('click', (e) => {
                    const rowDiv = e.target.closest('.item-card');
                    if(!rowDiv) return;
                    const id = parseFloat(rowDiv.dataset.id);
                    const row = this.data.find(r => r.id === id);

                    if(e.target.closest('.delete-btn')) {
                        if(confirm('Remove this item?')) {
                            this.data = this.data.filter(r => r.id !== id);
                            this.render(); this.save(false);
                        }
                    }
                    if(e.target.closest('.remark-toggle')) {
                        const input = rowDiv.querySelector('.remark-input-container');
                        input.classList.toggle('hidden');
                        if(!input.classList.contains('hidden')) input.querySelector('input').focus();
                    }
                    if(e.target.closest('.step-btn')) {
                        const action = e.target.closest('.step-btn').dataset.action;
                        const field = e.target.closest('.step-btn').dataset.field;
                        if(action === 'inc') row[field]++;
                        if(action === 'dec' && row[field] > 0) row[field]--;
                        this.renderRow(rowDiv, row);
                        this.save(false);
                    }
                    if(e.target.closest('.needed-toggle')) {
                        row.needed = row.needed === 0 ? 1 : 0;
                        this.renderRow(rowDiv, row);
                        this.save(false);
                    }
                });

                listBody.addEventListener('input', (e) => {
                    const rowDiv = e.target.closest('.item-card');
                    if(e.target.dataset.field && rowDiv) {
                        const id = parseFloat(rowDiv.dataset.id);
                        const row = this.data.find(r => r.id === id);
                        let val = e.target.value;
                        if(e.target.type === 'number') val = val === '' ? 0 : parseFloat(val);
                        row[e.target.dataset.field] = val;
                        if(e.target.dataset.field === 'unit') this.renderRow(rowDiv, row);
                    }
                });
                
                listBody.addEventListener('focusout', (e) => {
                    if(e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') this.save(false);
                });
            },
            save(showToast) {
                localStorage.setItem(CONFIG.storageKey, JSON.stringify(this.data));
                if(showToast) {
                    const toast = document.getElementById('toast');
                    toast.classList.remove('hidden'); void toast.offsetWidth;
                    toast.classList.remove('opacity-0', 'translate-y-[-20px]');
                    setTimeout(() => {
                        toast.classList.add('opacity-0', 'translate-y-[-20px]');
                        setTimeout(() => toast.classList.add('hidden'), 300);
                    }, 2000);
                }
            },
            render() {
                const container = document.getElementById('checklist-body');
                container.innerHTML = '';
                if(this.data.length === 0) {
                    container.innerHTML = `<div class="flex flex-col items-center justify-center py-20 text-gray-400"><span class="material-icons-round text-6xl mb-2 text-gray-200">playlist_add</span><p>List is empty.</p></div>`; return;
                }
                this.data.forEach(row => {
                    const div = document.createElement('div');
                    div.className = 'item-card bg-white p-4 rounded-2xl shadow-sm border border-gray-100 relative transition-all';
                    div.dataset.id = row.id;
                    this.renderRow(div, row);
                    container.appendChild(div);
                });
            },
            renderRow(element, row) {
                const isNeeded = row.needed > 0;
                const unitOptionsHtml = UNIT_OPTIONS.map(u => `<option value="${u}" ${row.unit === u ? 'selected' : ''}>${u}</option>`).join('');

                // LOGIC CHANGE: Check Needed and format for Print
                const printNeededHtml = isNeeded 
                    ? `<span class="text-red-600">${row.needed} <span class="unit-display-print text-red-500 font-normal text-xs uppercase">${row.unit}</span></span>`
                    : `<span class="text-green-600 font-bold text-xl leading-none" style="margin-top:-5px;">-</span>`;

                element.innerHTML = `
                    <div class="flex justify-between items-start mb-3 print:mb-0">
                        <div class="w-full mr-2">
                            <label class="text-[10px] font-bold text-gray-400 uppercase md:hidden block mb-1 no-print">Item Name</label>
                            <input type="text" value="${row.item}" data-field="item" class="item-name-print w-full font-bold text-lg text-gray-800 bg-transparent focus:outline-none placeholder-gray-300" placeholder="Item Name...">
                        </div>
                        <button class="delete-btn no-print text-gray-300 hover:text-red-500 p-1 -mt-1 -mr-1"><span class="material-icons-round">close</span></button>
                    </div>

                    <div class="flex gap-3 md:contents print:contents">
                        <div class="flex-1">
                            <label class="text-[10px] font-bold text-gray-400 uppercase md:hidden block mb-1 no-print">Current</label>
                            
                            <div class="hidden print:block qty-print">${row.current} <span class="unit-display-print">${row.unit}</span></div>
                            
                            <div class="flex items-center justify-between bg-gray-50 border border-gray-200 rounded-xl px-1 py-1 no-print">
                                <button class="step-btn w-8 h-8 flex items-center justify-center bg-white rounded-lg shadow-sm text-gray-500 active:bg-gray-100" data-action="dec" data-field="current"><span class="material-icons-round text-sm">remove</span></button>
                                <div class="flex flex-col items-center w-full px-1">
                                    <input type="number" value="${row.current}" data-field="current" class="w-full text-center bg-transparent font-bold text-gray-700 focus:outline-none text-lg p-0">
                                    <select data-field="unit" class="unit-select w-full focus:outline-none">${unitOptionsHtml}</select>
                                </div>
                                <button class="step-btn w-8 h-8 flex items-center justify-center bg-white rounded-lg shadow-sm text-brand-blue active:bg-blue-50" data-action="inc" data-field="current"><span class="material-icons-round text-sm">add</span></button>
                            </div>
                        </div>

                        <div class="flex-1">
                            <label class="text-[10px] font-bold text-gray-400 uppercase md:hidden block mb-1 no-print">Needed</label>
                            
                            <div class="hidden print:block needed-print">${printNeededHtml}</div>
                            
                            <div class="no-print h-full">
                                ${!isNeeded ? `
                                    <button class="needed-toggle w-full h-[54px] bg-green-50 border border-green-200 rounded-xl flex items-center justify-center gap-1 text-green-700 font-bold text-sm hover:bg-green-100 transition"><span class="material-icons-round text-sm">check</span> OK</button>
                                ` : `
                                    <div class="flex items-center justify-between bg-red-50 border border-red-200 rounded-xl px-1 py-1 animate-fadeIn h-[54px]">
                                        <button class="step-btn w-8 h-8 flex items-center justify-center bg-white rounded-lg shadow-sm text-red-300 active:bg-red-50" data-action="dec" data-field="needed"><span class="material-icons-round text-sm">remove</span></button>
                                        <div class="flex flex-col items-center w-full px-1">
                                            <input type="number" value="${row.needed}" data-field="needed" class="w-full text-center bg-transparent font-bold text-red-600 focus:outline-none text-lg p-0">
                                            <span class="text-[10px] text-red-400 font-bold uppercase">${row.unit}</span>
                                        </div>
                                        <button class="step-btn w-8 h-8 flex items-center justify-center bg-white rounded-lg shadow-sm text-red-600 active:bg-red-100" data-action="inc" data-field="needed"><span class="material-icons-round text-sm">add</span></button>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>

                    <div class="mt-3 md:mt-0 md:col-span-1 print:col-span-1">
                        <div class="hidden print:block remark-print">${row.remark}</div>
                        <div class="no-print">
                            ${row.remark || '' ? `
                                <div class="remark-input-container w-full"><input type="text" value="${row.remark}" data-field="remark" class="w-full text-sm text-gray-500 bg-gray-50 border-0 rounded px-2 py-1 italic focus:bg-white focus:ring-1 focus:ring-blue-300 transition" placeholder="Add note..."></div>
                            ` : `
                                <div class="flex justify-end remark-input-container hidden"><input type="text" value="" data-field="remark" class="w-full text-sm text-gray-500 bg-gray-50 border-0 rounded px-2 py-1 italic focus:bg-white focus:ring-1 focus:ring-blue-300 transition" placeholder="Type note..."></div>
                                <button class="remark-toggle ${row.remark ? 'hidden' : ''} flex items-center gap-1 text-xs text-gray-400 font-medium hover:text-brand-blue ml-auto mt-1"><span class="material-icons-round text-[14px]">edit_note</span> Add Note</button>
                            `}
                        </div>
                    </div>
                `;
            }
        };
        App.init();
    </script>
</body>
</html>
